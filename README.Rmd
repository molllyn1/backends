---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# backends

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

The goal of backends is to provide a web API that lists all known DBI backends.
It is implemented as a set of static JSON files

## Usage

### Query all packages

```{r all, eval = FALSE}
all <- httr::GET("https://r-dbi.github.io/backends/all.json")
httr::stop_for_status(all)
all_df <- httr::content(all, flatten = TRUE, simplifyVector = TRUE)
```

```{r all-from-file, include = FALSE}
all_df <- jsonlite::fromJSON("docs/all.json", flatten = TRUE)
```

```{r all-url}
fix_url <- function(x) {
  if (length(x) == 0 || anyNA(x)) {
    x <- ""
  }
  glue::glue_collapse(x, ", ")
}

all_df$url <- purrr::map_chr(all_df$url, fix_url)
all_df$bugs <- purrr::map_chr(all_df$bugs, fix_url)
all_df[] <- purrr::map(all_df, knitr:::escape_html)
all_df$description <- paste0("<details>", all_df$description, "</details>")
knitr::kable(all_df, "html", escape = FALSE)
```

### Query a single package

```{r single}
first_name <- all_df$name[[1]]
first_url <- paste0("https://r-dbi.github.io/backends/by-package/", first_name, ".json")
first <- httr::GET(first_url)
httr::stop_for_status(first)
httr::content(first)
```


## Updating the database

The database is updated via `script/prepare.R` which is run daily by GitHub Actions.
Existing packages are updated directly.
For new or removed packages, pull requests are opened.

---

Please note that the 'backends' project is released with a
[Contributor Code of Conduct](CODE_OF_CONDUCT.md).
By contributing to this project, you agree to abide by its terms.
